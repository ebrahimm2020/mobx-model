{"version":3,"sources":["../src/api.js"],"names":["config","warnings","longStackTraces","cancellation","API","options","Object","assign","request","method","data","endpoint","onSuccess","onError","fileData","superagent","requestData","requestHeaders","doRequest","Error","urlRoot","accept","keys","forEach","set","header","formData","FormData","append","attibuteName","file","send","retry","query","stringify","arrayFormat","end","err","response","onRequestCompleted","ok","onRequestError","resolve"],"mappings":"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","file":"api.js","sourcesContent":["\"use strict\";\n\nimport superagentDefault from \"superagent\";\nimport qs from \"qs\";\nimport BPromise from \"bluebird\";\n\nimport pick from \"lodash/pick\";\nimport isFunction from \"lodash/isFunction\";\nimport isEmpty from \"lodash/isEmpty\";\n\nBPromise.config({\n  warnings: true,\n  longStackTraces: true,\n  cancellation: true\n});\n\nconst API = {\n  config(options = {}) {\n    Object.assign(\n      this,\n      pick(options, [\"onRequestError\", \"onRequestCompleted\", \"requestData\", \"requestHeaders\", \"urlRoot\", \"superagent\"])\n    );\n  },\n\n  request(options = {}) {\n    let { method, data, endpoint, onSuccess, onError, fileData, superagent } = options;\n    let requestData, requestHeaders, doRequest;\n    const request = superagent || this.superagent || superagentDefault;\n\n    if (!method) {\n      method = \"get\";\n    }\n    if (!data) {\n      data = {};\n    }\n    if (!endpoint) {\n      throw new Error(\"Please provide an endpoint for an API call\");\n    }\n\n    if (!onSuccess) {\n      onSuccess = options => {};\n    }\n\n    if (!onError) {\n      onError = options => {};\n    }\n\n    // set headers\n    doRequest = request[method](this.urlRoot + endpoint);\n\n    if (isEmpty(fileData)) {\n      doRequest.accept(\"json\");\n    }\n\n    if (isFunction(this.requestHeaders)) {\n      requestHeaders = this.requestHeaders();\n    } else {\n      requestHeaders = this.requestHeaders;\n    }\n\n    Object.keys(requestHeaders).forEach(header => {\n      doRequest = doRequest.set(header, requestHeaders[header]);\n    });\n\n    // for now do not send any data except files if they are passed\n    if (!isEmpty(fileData)) {\n      // merge default requestData with object passed with this request\n      if (isFunction(this.requestData)) {\n        requestData = this.requestData();\n      } else {\n        requestData = this.requestData;\n      }\n\n      Object.assign(data, requestData);\n    }\n\n    // just send as POST or prepare data for GET request\n    if (method === \"post\" || method === \"put\") {\n      if (!isEmpty(fileData)) {\n        let formData = new FormData();\n        formData.append(fileData.attibuteName, fileData.file);\n        doRequest.send(formData);\n      } else {\n        doRequest.send(data);\n      }\n    } else if (method === \"get\" || method == \"del\") {\n      doRequest.retry(3).query(qs.stringify(data, { arrayFormat: \"brackets\" }));\n    }\n\n    return new BPromise(resolve => {\n      // send request and act upon result\n      doRequest.end((err, response) => {\n        if (this.onRequestCompleted) this.onRequestCompleted(response);\n\n        if (!response || !response.ok) {\n          //let errors = response.body ? response.body.errors : 'Something bad happened';\n          //let statusCode = response.status;\n\n          if (this.onRequestError) this.onRequestError(response, err);\n\n          onError(response);\n        } else {\n          onSuccess(response);\n        }\n\n        /*\n          we resolve promise even if request\n          was not successfull to reduce boilerplat\n          + because we  typically don't want ui do\n          have some specific behaviour in this case\n         */\n\n        resolve(response);\n      });\n    });\n  }\n};\n\nexport default API;\n"]}