{"version":3,"sources":["../src/api.js"],"names":["config","warnings","longStackTraces","cancellation","API","options","Object","assign","request","method","data","endpoint","onSuccess","onError","fileData","superagent","requestData","requestHeaders","doRequest","Error","urlRoot","accept","keys","forEach","set","header","formData","FormData","append","attibuteName","file","send","query","stringify","arrayFormat","resolve","end","err","response","onRequestCompleted","ok","onRequestError"],"mappings":"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","file":"api.js","sourcesContent":["'use strict';\n\nimport superagentDefault from 'superagent';\nimport qs from 'qs';\nimport BPromise from 'bluebird';\n\nimport pick from 'lodash/pick';\nimport isFunction from 'lodash/isFunction';\nimport isEmpty from 'lodash/isEmpty';\n\nBPromise.config({\n  warnings: true,\n  longStackTraces: true,\n  cancellation: true\n});\n\n\nconst API = {\n\n  config(options = {}) {\n    Object.assign(this, pick(options, [\n      'onRequestError',\n      'onRequestCompleted',\n      'requestData',\n      'requestHeaders',\n      'urlRoot',\n      'superagent'\n    ]))\n  },\n\n\trequest(options = {}) {\n\n\t\tlet { method, data, endpoint, onSuccess, onError, fileData, superagent } = options;\n    let requestData, requestHeaders, doRequest;\n    const request = superagent || this.superagent || superagentDefault;\n\n\t\tif (!method) { method = 'get' }\n\t\tif (!data) { data = {} }\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Please provide an endpoint for an API call');\n\t\t}\n\n\t\tif (!onSuccess) {\n\t\t\tonSuccess = (options) => { }\n\t\t}\n\n    if (!onError) {\n      onError = (options) => { }\n    }\n\n    // set headers\n\t\tdoRequest = request[method](this.urlRoot+endpoint);\n\n\n    if (isEmpty(fileData)) {\n      doRequest.accept('json');\n    }\n\n    if (isFunction(this.requestHeaders)) {\n      requestHeaders = this.requestHeaders();\n    } else {\n      requestHeaders = this.requestHeaders;\n    }\n\n    Object.keys(requestHeaders).forEach(header => {\n      doRequest = doRequest.set(header, requestHeaders[header]);\n    });\n\n    // for now do not send any data except files if they are passed\n    if (!isEmpty(fileData)) {\n      // merge default requestData with object passed with this request\n      if (isFunction(this.requestData)) {\n  \t\t  requestData = this.requestData();\n      } else {\n        requestData = this.requestData;\n      }\n\n      Object.assign(data, requestData);\n    }\n\n    // just send as POST or prepare data for GET request\n    if (method === 'post' || method === 'put') {\n      if (!isEmpty(fileData)) {\n        let formData = new FormData();\n        formData.append(fileData.attibuteName, fileData.file);\n        doRequest.send(formData);\n      } else {\n        doRequest.send(data);\n      }\n    } else if (method === 'get' || method == 'del') {\n      doRequest.query(\n        qs.stringify(\n          data,\n          { arrayFormat: 'brackets' }\n        )\n      );\n    }\n\n    return new BPromise( (resolve) => {\n\n      // send request and act upon result\n    \tdoRequest.end( (err, response) => {\n        if (this.onRequestCompleted) this.onRequestCompleted(response);\n\n\t      if (!response.ok) {\n\t      \t//let errors = response.body ? response.body.errors : 'Something bad happened';\n      \t\t//let statusCode = response.status;\n\n      \t\tif (this.onRequestError) this.onRequestError(response);\n\n          onError(response);\n\t      } else {\n\t      \tonSuccess(response);\n        }\n\n        /*\n          we resolve promise even if request\n          was not successfull to reduce boilerplat\n          + because we  typically don't want ui do\n          have some specific behaviour in this case\n         */\n\n        resolve(response);\n\n      });\n\n    });\n\n\t}\n};\n\nexport default API;\n"]}